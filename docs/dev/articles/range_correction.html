<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Correction for range effects • bioRad</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/yeti/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><!-- docsearch --><script src="../docsearch.js"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.css" integrity="sha256-QOSRU/ra9ActyXkIBbiIB144aDBdtvXBcNc3OTNuX/Q=" crossorigin="anonymous">
<link href="../docsearch.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script><meta property="og:title" content="Correction for range effects">
<meta property="og:description" content="">
<meta property="og:image" content="https://adokter.github.io/bioRad/logo.png">
<meta name="twitter:card" content="summary">
<meta name="robots" content="noindex">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">bioRad</a>
        <span class="version label label-danger" data-toggle="tooltip" data-placement="bottom" title="In-development version">0.4.0.9241</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/bioRad.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/rad_aero_19.html">Introductory exercises with bioRad</a>
    </li>
    <li>
      <a href="../articles/range_correction.html">Correction for range effects</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/adokter/bioRad">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
<form class="navbar-form navbar-right" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off">
</div>
      </form>
      
    </div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Correction for range effects</h1>
                        <h4 class="author">Adriaan M. Dokter</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/adokter/bioRad/blob/master/vignettes/range_correction.Rmd"><code>vignettes/range_correction.Rmd</code></a></small>
      <div class="hidden name"><code>range_correction.Rmd</code></div>

    </div>

    
    
<div id="preparations" class="section level2">
<h2 class="hasAnchor">
<a href="#preparations" class="anchor"></a>1. preparations</h2>
<p>Load bioRad</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" title="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(bioRad)</a></code></pre></div>
<pre><code>## Welcome to bioRad version 0.4.0.9238</code></pre>
<pre><code>## Docker daemon running, Docker functionality enabled (vol2bird version 0.4.0)</code></pre>
</div>
<div id="beam-propagation" class="section level2">
<h2 class="hasAnchor">
<a href="#beam-propagation" class="anchor"></a>2. beam propagation</h2>
<p>We start with the changing properties of the radar beam as it propagates through the atmosphere. We define:</p>
<ul>
<li>
<strong>range</strong>: the length of the skywave path between target and the radar antenna, also known as <em>slant range</em>
</li>
<li>
<strong>distance</strong>: the distance of the target from the radar as measured along the earth’s surface, also known as <em>down range</em>.</li>
</ul>
<p>The beam height is changing as a result of earth’s curvature, and beam refraction:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" title="1"><span class="co"># define a range grid from 0 to 200 km:</span></a>
<a class="sourceLine" id="cb4-2" title="2">my_range &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/seq">seq</a></span>(<span class="dv">0</span>, <span class="dv">200000</span>, <span class="dv">1000</span>)</a>
<a class="sourceLine" id="cb4-3" title="3"><span class="co"># plot the beam height for each range, for a 0.5 degree elevation beam:</span></a>
<a class="sourceLine" id="cb4-4" title="4"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(my_range, <span class="kw"><a href="../reference/beam_height.html">beam_height</a></span>(my_range, <span class="dt">elev =</span> <span class="fl">.5</span>), <span class="dt">xlab =</span> <span class="st">"range [m]"</span>, <span class="dt">ylab =</span> <span class="st">"beam height [m]"</span>)</a></code></pre></div>
<p><img src="range_correction_files/figure-html/unnamed-chunk-2-1.png" width="700"></p>
<p>The beam width also broadens with range:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" title="1"><span class="co"># plot the beam width, for a beam opening angle of 1 degree (typical for most weather radars):</span></a>
<a class="sourceLine" id="cb5-2" title="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(my_range, <span class="kw"><a href="../reference/beam_width.html">beam_width</a></span>(my_range, <span class="dt">beam_angle =</span> <span class="dv">1</span>), <span class="dt">xlab =</span> <span class="st">"range [m]"</span>, <span class="dt">ylab =</span> <span class="st">"beam width [m]"</span>)</a></code></pre></div>
<p><img src="range_correction_files/figure-html/unnamed-chunk-3-1.png" width="700"></p>
<p>We can now combine the relations for beam width and beam height, to calculate the beam profile as a function of height, i.e. the altitudinal normalized distribution of radiated energy by the beam. Let’s plot the radiation profile for a 0.5 and 2 degree beam elevation at 50 km from the radar (the height axis runs from ground level straight up):</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" title="1"><span class="co"># plot the beam profile, for a 0.5 degree elevation beam at 50 km distance from the radar:</span></a>
<a class="sourceLine" id="cb6-2" title="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(<span class="kw"><a href="../reference/beam_profile.html">beam_profile</a></span>(<span class="dt">height =</span> <span class="dv">0</span><span class="op">:</span><span class="dv">4000</span>, <span class="dv">50000</span>, <span class="fl">0.5</span>), <span class="dv">0</span><span class="op">:</span><span class="dv">4000</span>, <span class="dt">xlab =</span> <span class="st">"normalized radiated energy"</span>, <span class="dt">ylab =</span> <span class="st">"height [m]"</span>, <span class="dt">main =</span> <span class="st">"beam elevation: 0.5 deg, distance=50km"</span>)</a></code></pre></div>
<p><img src="range_correction_files/figure-html/unnamed-chunk-4-1.png" width="700"></p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" title="1"><span class="co"># plot the beam profile, for a 2 degree elevation beam at 50 km distance from the radar:</span></a>
<a class="sourceLine" id="cb7-2" title="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(<span class="kw"><a href="../reference/beam_profile.html">beam_profile</a></span>(<span class="dt">height =</span> <span class="dv">0</span><span class="op">:</span><span class="dv">4000</span>, <span class="dv">50000</span>, <span class="dv">2</span>), <span class="dv">0</span><span class="op">:</span><span class="dv">4000</span>, <span class="dt">xlab =</span> <span class="st">"normalized radiated energy"</span>, <span class="dt">ylab =</span> <span class="st">"height [m]"</span>, <span class="dt">main =</span> <span class="st">"beam elevation: 2 deg, distance=50km"</span>)</a></code></pre></div>
<p><img src="range_correction_files/figure-html/unnamed-chunk-4-2.png" width="700"></p>
<p>We can also calculate the normalized radiation profile for the two beams combined:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" title="1"><span class="co"># plot the combined beam profile for a 0.5 and 2.0 degree elevation beam at 50 km distance from the radar:</span></a>
<a class="sourceLine" id="cb8-2" title="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(<span class="kw"><a href="../reference/beam_profile.html">beam_profile</a></span>(<span class="dt">height =</span> <span class="dv">0</span><span class="op">:</span><span class="dv">4000</span>, <span class="dv">50000</span>, <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="fl">0.5</span>, <span class="dv">2</span>)), <span class="dv">0</span><span class="op">:</span><span class="dv">4000</span>, <span class="dt">xlab =</span> <span class="st">"normalized radiated energy"</span>, <span class="dt">ylab =</span> <span class="st">"height [m]"</span>, <span class="dt">main =</span> <span class="st">"beam elevations: 0.5,2 deg, distance=50km"</span>)</a></code></pre></div>
<p><img src="range_correction_files/figure-html/unnamed-chunk-5-1.png" width="700"></p>
</div>
<div id="vertical-profiles-and-polar-volumes" class="section level2">
<h2 class="hasAnchor">
<a href="#vertical-profiles-and-polar-volumes" class="anchor"></a>3. vertical profiles and polar volumes</h2>
<p>Let us now assume we have calculated a vertical profile (of birds) for a certain polar volume file. Let’s load an example</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" title="1"><span class="co"># let's load an example polar volume:</span></a>
<a class="sourceLine" id="cb9-2" title="2">pvolfile &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/system.file">system.file</a></span>(<span class="st">"extdata"</span>, <span class="st">"volume.h5"</span>, <span class="dt">package =</span> <span class="st">"bioRad"</span>)</a>
<a class="sourceLine" id="cb9-3" title="3">example_pvol &lt;-<span class="st"> </span><span class="kw"><a href="../reference/read_pvolfile.html">read_pvolfile</a></span>(<span class="dt">file =</span> pvolfile)</a>
<a class="sourceLine" id="cb9-4" title="4"><span class="co"># a vertical profile can also be calculated from the polar volume directly, using</span></a>
<a class="sourceLine" id="cb9-5" title="5"><span class="co"># calculate_vp(pvolfile)</span></a>
<a class="sourceLine" id="cb9-6" title="6"><span class="co"># but for now we will use bioRad's example vertical profile already calculated:</span></a>
<a class="sourceLine" id="cb9-7" title="7">example_vp</a></code></pre></div>
<pre><code>##                Vertical profile (class vp)
## 
##        radar:  seang 
##       source:  WMO:02606,RAD:SE50,PLC:Angelholm,NOD:seang,ORG:82,CTY:643,CMT:Swedish radar 
## nominal time:  2015-10-18 18:00:00 
## generated by:  vol2bird 0.3.17</code></pre>
<p>Let’s plot the vertical profile, for the quantity eta (the linear reflectivity):</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" title="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(example_vp, <span class="dt">quantity =</span> <span class="st">"eta"</span>)</a></code></pre></div>
<p><img src="range_correction_files/figure-html/unnamed-chunk-7-1.png" width="700"></p>
<p>Note that eta is directly related to reflectivity factor (DBZH), i.e. a reflectivity factor of 5 dBZ amounts to the following eta at a radar wavelength of 5.3 cm:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" title="1"><span class="kw"><a href="../reference/dbz_to_eta.html">dbz_to_eta</a></span>(<span class="dv">5</span>, <span class="dt">wavelength =</span> <span class="fl">5.3</span>)</a></code></pre></div>
<pre><code>## [1] 1060.747</code></pre>
</div>
<div id="range-correction" class="section level2">
<h2 class="hasAnchor">
<a href="#range-correction" class="anchor"></a>4. range correction</h2>
<p>Range correction is implemented as follows:</p>
<p>We start with:</p>
<ul>
<li>a polar volume, containing multiple scans</li>
<li>a vertical profile (of birds) calculated for that polar volume</li>
<li>a grid that we define relative to the earth’s surface, on which we will calculate the range corrected image. The pixel locations on the ground are easily translated into a corresponding azimuth and range of the various scans (see function <code><a href="../reference/beam_range.html">beam_range()</a></code>).</li>
</ul>
<p>For each scan within the polar volume we:</p>
<ul>
<li>calculate for each ground surface pixel the vertical radiation profile at that pixel for that particular scan, following above paragraph 2.</li>
<li>calculate the reflectivity we expect at that pixel (<span class="math inline">\(eta_{expected}\)</span>), given the vertical profile (of birds) and the part of the profile radiated by the beam. This <span class="math inline">\(eta_{expected}\)</span> is simply the average of (linear) eta in the profile (as plotted in paragraph 3 above), weighted by the vertical radiation profile (as plotted in paragraph 2).</li>
<li>we also calculated the observed eta at this pixel, which is simply given by <code><a href="../reference/dbz_to_eta.html">dbz_to_eta(DBZH)</a></code> (see paragraph 3), with DBZH the reflectivity factor measured at the pixel’s distance from the radar.</li>
</ul>
<p>For each pixel on the ground, we thus end up with a set of <span class="math inline">\(eta_{expected}\)</span> and a set of <span class="math inline">\(eta_{observed}\)</span>. From those we can calculate a correction factor at that pixel, as <span class="math inline">\(correction\_factor=\sum{eta_{observed}}/\sum{eta_{expected}}\)</span>, with the sum running over scans.</p>
<p>To arrive at the final PPI image:</p>
<ul>
<li>we calculate the vertically integrated density (<code>vid</code>) and vertically integrated reflectivity (<code>vir</code>) for the profile, using the function <code><a href="../reference/integrate_profile.html">integrate_profile()</a></code>.</li>
<li>the spatial range-corrected PPI for <code>vid</code> is simply the correction_factor image, multiplied by the <code>vid</code> calculated for the profile</li>
<li>Likewise, the spatial range-corrected PPI for vir is simply the <code>correction_factor</code> image, multiplied by the <code>vir</code> calculated for the profile</li>
</ul>
</div>
<div id="range-correction-example" class="section level2">
<h2 class="hasAnchor">
<a href="#range-correction-example" class="anchor"></a>5. range correction example</h2>
<p>Let’s first make a PPI plot of the lowest uncorrected scan:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" title="1"><span class="co"># extract the first scan from the polar volume:</span></a>
<a class="sourceLine" id="cb14-2" title="2">my_scan &lt;-<span class="st"> </span>example_pvol<span class="op">$</span>scans[[<span class="dv">1</span>]]</a>
<a class="sourceLine" id="cb14-3" title="3"><span class="co"># project it as a PPI on the ground:</span></a>
<a class="sourceLine" id="cb14-4" title="4">my_ppi &lt;-<span class="st"> </span><span class="kw"><a href="../reference/project_as_ppi.html">project_as_ppi</a></span>(my_scan, <span class="dt">range_max =</span> <span class="dv">100000</span>)</a>
<a class="sourceLine" id="cb14-5" title="5"><span class="co"># plot it</span></a>
<a class="sourceLine" id="cb14-6" title="6"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(my_ppi)</a></code></pre></div>
<pre><code>## Warning in f(...): Raster pixels are placed at uneven horizontal intervals
## and will be shifted. Consider using geom_tile() instead.</code></pre>
<pre><code>## Warning in f(...): Raster pixels are placed at uneven vertical intervals
## and will be shifted. Consider using geom_tile() instead.</code></pre>
<p><img src="range_correction_files/figure-html/unnamed-chunk-9-1.png" width="700"></p>
<p>Now let’s calculate the range-corrected PPI</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" title="1"><span class="co"># let's use a 500 metre spatial grid (res), and restrict to 100x100 km area</span></a>
<a class="sourceLine" id="cb17-2" title="2">my_corrected_ppi &lt;-<span class="st"> </span><span class="kw"><a href="../reference/integrate_to_ppi.html">integrate_to_ppi</a></span>(example_pvol, example_vp, <span class="dt">res =</span> <span class="dv">500</span>, <span class="dt">xlim =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="op">-</span><span class="dv">100000</span>, <span class="dv">100000</span>), <span class="dt">ylim =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="op">-</span><span class="dv">100000</span>, <span class="dv">100000</span>))</a>
<a class="sourceLine" id="cb17-3" title="3">my_corrected_ppi</a></code></pre></div>
<pre><code>##                Plan position indicator (class ppi)
## 
##   quantities:  vir vid correction_factor overlap 
##         dims:  400 x 400 pixels</code></pre>
<p>The range corrected PPI has four parameters: vir, vid, correction_factor, overlap. Let’s plot the correction factor:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" title="1"><span class="co"># plot the correction_factor:</span></a>
<a class="sourceLine" id="cb19-2" title="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(my_corrected_ppi, <span class="dt">param =</span> <span class="st">"correction_factor"</span>)</a></code></pre></div>
<p><img src="range_correction_files/figure-html/unnamed-chunk-11-1.png" width="700"></p>
<p>Let’s also plot the vertically integrated reflectivity:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb20-1" title="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(my_corrected_ppi, <span class="dt">param =</span> <span class="st">"vir"</span>)</a></code></pre></div>
<p><img src="range_correction_files/figure-html/unnamed-chunk-12-1.png" width="700"></p>
<p>Or plot the vertically integrated density on a map:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb21-1" title="1">bm &lt;-<span class="st"> </span><span class="kw"><a href="../reference/download_basemap.html">download_basemap</a></span>(my_corrected_ppi)</a></code></pre></div>
<pre><code>## Downloading zoom = 8 ...</code></pre>
<pre><code>## Source : http://tile.stamen.com/terrain/8/136/78.png</code></pre>
<pre><code>## Source : http://tile.stamen.com/terrain/8/137/78.png</code></pre>
<pre><code>## Source : http://tile.stamen.com/terrain/8/138/78.png</code></pre>
<pre><code>## Source : http://tile.stamen.com/terrain/8/136/79.png</code></pre>
<pre><code>## Source : http://tile.stamen.com/terrain/8/137/79.png</code></pre>
<pre><code>## Source : http://tile.stamen.com/terrain/8/138/79.png</code></pre>
<pre><code>## Source : http://tile.stamen.com/terrain/8/136/80.png</code></pre>
<pre><code>## Source : http://tile.stamen.com/terrain/8/137/80.png</code></pre>
<pre><code>## Source : http://tile.stamen.com/terrain/8/138/80.png</code></pre>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb32-1" title="1"><span class="kw"><a href="../reference/map.html">map</a></span>(my_corrected_ppi, bm, <span class="dt">param =</span> <span class="st">"vir"</span>, <span class="dt">alpha =</span> <span class="fl">.5</span>)</a></code></pre></div>
<p><img src="range_correction_files/figure-html/unnamed-chunk-13-1.png" width="700"></p>
</div>
<div id="overlap-between-radiation-profile-and-bird-profile" class="section level2">
<h2 class="hasAnchor">
<a href="#overlap-between-radiation-profile-and-bird-profile" class="anchor"></a>6. overlap between radiation profile and bird profile</h2>
<p>At large distances from the radar we expect correction for range effects to become more difficult:</p>
<ol style="list-style-type: decimal">
<li>radar beams start to overshoot the aerial layers with biology, i.e. the overlap between the vertical profile and the emitted radiation profile decreases</li>
<li>at large distances weak biological echoes may get below the radar’s detection level</li>
</ol>
<p>We can calculate overlap between emitted radiation and the biological profile as follows:</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb33-1" title="1"><span class="co"># calculate overlap between vertical profile of birds</span></a>
<a class="sourceLine" id="cb33-2" title="2"><span class="co"># and the vertical radiation profile emitted by the radar:</span></a>
<a class="sourceLine" id="cb33-3" title="3">bpo &lt;-<span class="st"> </span><span class="kw"><a href="../reference/beam_profile_overlap.html">beam_profile_overlap</a></span>(example_vp, <span class="kw"><a href="../reference/get_elevation_angles.html">get_elevation_angles</a></span>(example_pvol), <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/seq">seq</a></span>(<span class="dv">0</span>, <span class="dv">100000</span>, <span class="dv">1000</span>), <span class="dt">quantity =</span> <span class="st">"eta"</span>)</a>
<a class="sourceLine" id="cb33-4" title="4"><span class="co"># plot the calculated overlap:</span></a>
<a class="sourceLine" id="cb33-5" title="5"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(bpo)</a></code></pre></div>
<p><img src="range_correction_files/figure-html/unnamed-chunk-14-1.png" width="700"></p>
<p>The function first normalizes the vertical profile altitudinal distribution. This can be either using profile quantity eta or dens, whichever is preferred (note that dens, the density, is sometimes thresholded to zero based on radial velocity standard deviation, see <code><a href="../reference/sd_vvp_threshold.html">sd_vvp_threshold()</a></code>, while eta is not)</p>
<p>It then calculates the overlap between the normalized vertical profile, and the normalized radiation profile as calculated with <code><a href="../reference/beam_profile.html">beam_profile()</a></code>, using a metric called the <a href="https://en.wikipedia.org/wiki/Bhattacharyya_distance">Bhattacharyya distance</a>. This metric is zero when there is no overlap, and 1 when the distributions are identical.</p>
<p>The range-corrected PPI also contains a field <code>overlap</code>, which contains the same metric but then calculated on the grid of the PPI:</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb34-1" title="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(my_corrected_ppi, <span class="dt">param =</span> <span class="st">"overlap"</span>)</a></code></pre></div>
<p><img src="range_correction_files/figure-html/unnamed-chunk-15-1.png" width="700"></p>
<p>The overlap metric might be used in the future to show only certain section of the PPI, based on their overlap value.</p>
</div>
<div id="to-do" class="section level2">
<h2 class="hasAnchor">
<a href="#to-do" class="anchor"></a>7. To do</h2>
<ul>
<li>implementation of a <code>noise_floor</code> parameter, by which one can determine at which distance birds are expected to be below noise level, given their vertical profile. Affects function <code><a href="../reference/beam_profile_overlap.html">beam_profile_overlap()</a></code>.</li>
<li>testing of all the functions</li>
<li>double-checking all the naming conventions</li>
<li>writing more detailed documentation of the functions</li>
</ul>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#preparations">1. preparations</a></li>
      <li><a href="#beam-propagation">2. beam propagation</a></li>
      <li><a href="#vertical-profiles-and-polar-volumes">3. vertical profiles and polar volumes</a></li>
      <li><a href="#range-correction">4. range correction</a></li>
      <li><a href="#range-correction-example">5. range correction example</a></li>
      <li><a href="#overlap-between-radiation-profile-and-bird-profile">6. overlap between radiation profile and bird profile</a></li>
      <li><a href="#to-do">7. To do</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by <a href="http://adriaandokter.com">Adriaan M. Dokter</a>, <a href="https://twitter.com/peterdesmet">Peter Desmet</a>, <a href="https://twitter.com/SVanHoey">Stijn Van Hoey</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
</div>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.js" integrity="sha256-GKvGqXDznoRYHCwKXGnuchvKSwmx9SRMrZOTh2g4Sb0=" crossorigin="anonymous"></script><script>
  docsearch({
    
    
    apiKey: '482e77c49caf113078e572738762cf40',
    indexName: 'biorad',
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script>
</body>
</html>
